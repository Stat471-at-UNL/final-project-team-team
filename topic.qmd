---
title: "Airbnb Data Report: Predicting Price of New York City Listings"
author:
- "Tyler Davis"
- "Grey Gergen"
- "Jack Macfadyen"
- "Jesus Rodriguez"
format: pdf
execute:
  echo: false     
  warning: false 
  message: false 
editor_options: 
  chunk_output_type: inline
  
---

```{r setup}
library(tidyverse)
library(patchwork)
library(naniar)
library(skimr)
library(visdat)
library(mice)
library(rapportools) 
library(knitr)# added, couldn't render is.empty() w/out it
library(kableExtra)
source("data_pull.R")
options(knitr.kable.NA = '')
```

# Motivation

There are many considerations that must be made when finding temporary housing, either for vacations or business trips. Airbnb is a popular website that allows individuals or businesses to list potential places for users to choose. These users can choose where they wish to stay based on location, accommodations, how many beds they need, and price. We sought to create a model that predicts the price of an Airbnb listing based on various variables. This will be useful to both users who wish to find an expected price of an accommodation based on various desired characteristics as well as hosts who want a robust method of finding appropriate pricing for their listing.

Airbnb data for major cities across the world has been scraped by a team of contributors and gathered on a website [here](https://insideairbnb.com/get-the-data/) in October 2025. Their motivation is to show transparency in how spaces are being rented to tourists in their communities. For the purposes of this report, we took a sample of all Airbnb listings from New York City.

When coming across this dataset, we found several missing values in the price of different Airbnb listings. Of the `r nrow(df)` listings we found `r sum(rapportools::is.empty(df$price))` missing prices. We believe that we can use the latitude, longitude, beds, bathrooms, and neighborhood location among other variables to reliably impute the missing pricing data for these listings.

# Data Documentation

```{r}
data_documentation <- 
  readr::read_csv(
    "Inside Airbnb Data Dictionary - listings.csv detail v4.3.csv",
    skip = 7, # removed the first 7 rows
    col_names = T) %>% 
  slice(1:(79-4)) # removed the last 4 rows
```

```{r, eval = F}
## COMMENT: I tried to make this work, but no luck
## I think our best option is to make another .qmd file called data_documentation
## and just have it load the kable as html

## Then here, we can just link to the data_documentation.qmd file, I *think* that would work


#| label: data_documentation_table
#| tbl-cap: Data Dictionary
data_documentation %>% 
  filter(!Field == "room_type") %>% 
  select(1,2,3,4) %>% 
  kable("latex", booktabs = T)
```

# Data Cleaning {.hidden}

```{r}
filter_df <-
  df 
# %>% 
  # filter(host_identity_verified == "t", has_availability == "t")
# %>% select(1,6,7,8,10,13,15,16,17,18,19,23,24,28,29,30:41)

## fixing missing values
filter_df[filter_df == "N/A"] <- NA
filter_df[filter_df == ""] <- NA
filter_df[filter_df == "[]"] <- NA
filter_df[filter_df == "-"] <- NA

## changing price from chr to numeric
filter_df <-
  filter_df %>% 
  mutate(
    price = str_remove_all(price, "\\$"),
    price = str_remove_all(price, "\\,"),
    price = as.numeric(price), 
    id = as.factor(id)
  ) %>% 
  filter(price <= 10000 | is.na(price)) %>% 
## Cleaning the missing (non-missing) values in bathrooms from bathroom_text
  mutate(
    bathrooms =
      case_when(
        str_detect(bathrooms_text, "H|half") ~ 0.5,
        is.na(bathrooms) ~ str_extract(bathrooms_text, "\\d+\\.?\\d*") %>% as.numeric(),
        TRUE ~ bathrooms
      )
  )

# host response rate/acceptance rate cleaning
# as well as some bathrooms/bathrooms_text cleaning

filter_df$host_response_rate <- as.numeric(sub("%", "", filter_df$host_response_rate)) / 100
filter_df$host_acceptance_rate <- as.numeric(sub("%", "", filter_df$host_acceptance_rate)) / 100
filter_df$bathrooms <- ifelse(is.na(filter_df$bathrooms), as.numeric(sub(" .*", "", filter_df$bathrooms_text)), filter_df$bathrooms)

## Formatting columns

filter_df <- 
  filter_df %>% 
  mutate(
    across(
      c(
        neighbourhood_group_cleansed,
        neighbourhood_cleansed,
        property_type, 
        room_type,
        host_id,
        host_is_superhost,
        host_response_time
      ), 
      as.factor
    )
  )
```

# Variable Overview

The process for choosing important variables in our model relied on a combination of determining which information is pertinent and relevant to actual usage by both users and hosts. The variable selection used for each variable is explained in the following sections.

## `Price`

The `price` variable describes the daily price for a listing in its local currency. Since all listings in this analysis are from New York City, all prices are in \$USD. There are `r format(sum(!is.na(filter_df$price)), scientific = FALSE, big.mark = ",")` valid observations of price where it not missing and has a numerical value.

### Summary Statistics

```{r}
tab1 <- filter_df %>%
  select(price, beds, bedrooms, bathrooms) %>%
  summary() %>%
  kable(digits = 2, format = "latex", booktabs = TRUE)

tab2 <- filter_df %>%
  select(accommodates, host_is_superhost, latitude, longitude) %>%
  summary() %>%
  kable(digits = 2, format = "latex", booktabs = TRUE)

kables(list(tab1, tab2))
```


The `price` variable has a mean of `r paste0("$", round(mean(filter_df$price), 2))` and a median of `r paste0("$", median(filter_df$price))`.

We decided to consider all listings at or above the price of \$10,000 per night an outlier. There were a considerable group of listings above this number, going all the way to \$50,000 per night. Many of the listings we examined manually had different, more realistic prices on the actual Airbnb website, indicating that either the listing was improper during the webscrape, or the webscrape itself had flaws. We chose \$10,000 as the cutoff point as there was a listing at \$9,999 per night that was verifiable. The smallest price in the dataset is \$10 a night.

There are `r sum(is.na(filter_df$price))` missing values in `price`, which means missing values account for `r paste0(round(sum(is.na(filter_df$price)) / nrow(filter_df), 4) * 100, "%")` of the observations in the dataset.
